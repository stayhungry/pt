<!DOCTYPE html>
<html>
<head>
	<title>File Upload using HTML5 with Flash fallback</title>

	<script type="text/javascript" src="fup/modernizr.custom.js"></script>

	<!-- leverage CDN or user's exiting cache first with fallback on local -->
	<script type="text/javascript">
		Modernizr.load([
			{
			  load: 'http://ajax.googleapis.com/ajax/libs/jquery/1.6.2/jquery.min.js',
			  complete: function () {
			    if (!window.jQuery) {
			      Modernizr.load('fup/jquery-1.6.2.min.js');
			    }
			  }
			}
		]);		
	</script>

	<script type="text/javascript" src="fup/nysi.core.js"></script>

	<script type="text/javascript" src="uploadify/swfobject.js"></script>
	<script type="text/javascript" src="uploadify/jquery.uploadify.v2.1.4.min.js"></script>


	<style>
	.html-polyfills { display: none; }
	</style>

</head>

<body>

<div id="html5-impl" class="html-polyfills"> 
	<form id="fup-form">
	    <input type="file" id="file-to-upload" multiple/>
	    <br/>
	    <input type="button" id="btn-upload" value="Upload" />
	</form>
	<div id="fup-info">
	  <div id="file-info">
	    <div id="file-name"></div>
	    <div id="file-size"></div>
	    <div id="file-type"></div>
	  </div>
	  <div id="progress-indicator">
	    <div id="progress-bar" class="floatLeft"></div>
	    <div id="progress-number" class="floatRight">&nbsp;</div>
	    <div class="clear"></div>
	    <div>
	      <div id="transfer-speed-info" class="floatLeft" style="width: 80px;">&nbsp;</div>
	      <div id="time-remaining-info" class="floatLeft" style="margin-left: 10px;">&nbsp;</div>
	      <div id="transfer-bytes-info" class="floatRight" style="text-align: right;">&nbsp;</div>
	      <div class="clear"></div>
	    </div>    
	    <div id="upload-response"></div>
	  </div>  
	</div>
</div>

<!-- 3 musts:  client-side:  id="file_upload" and "fileName" can't be used as selector id;  server-side: $file_id='Filedata' -->
<div id="flash-impl" class="html-polyfills"> 
	<input type="file" id="file_upload" />
	<input type="button" id="btn_upload" value="Upload" />
</div>

<script type="text/javascript">
  var pathToUpload = "http://mylaptop/pt/fileupload/fup.php"


	$(document).ready(function(){

		Modernizr.load({
		  test: !!window.FileReader && Modernizr.draganddrop,
		  yep: {
		    'html5js': 'fup/nysi.html5.js'
		  },
		  nope: {
		    'flashcss': 'uploadify/uploadify.css',
		    'flashjs': 'fup/nysi.flash.js'
		  },
		  callback: {
		    'html5js': function (url, result, key) {
		      console.log('using HTML5!');
		      initHtml5();
		    },
		    'flashjs': function (url, result, key) {
		      console.log('using flash!');
     			initFlash();
		    }
		  },
		  complete: function () {
		    //alert('Everything has loaded in this test object!');
		  }
		});
		
	});


	function initHtml5(){
		$('#html5-impl').show();
		var nysiFileUpload = NYSI.html5.filemgr.bootstrap();	
		$('#file-to-upload').bind({
			change: function(e) {
				nysiFileUpload.fileSelected();
				e.preventDefault();
			}
		});
		$('#btn-upload').bind({
			click: function(e) {
				nysiFileUpload.uploadFiles();
			}
		});
	}

	function initFlash(){
		$('#flash-impl').show();
		NYSI.flash.filemgr.bootstrap();
		$('#btn_upload').bind({
			click: function(e) {
				$('#file_upload').uploadifyUpload();
			}
		});
	}
	

</script>

</body>
</html>
